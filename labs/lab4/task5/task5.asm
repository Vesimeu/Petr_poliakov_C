.ORIG x3000

; Регистры:
; R0 - текущий элемент
; R1 - следующий элемент
; R2 - флаг обмена
; R3 - счетчик внешнего цикла
; R4 - счетчик внутреннего цикла
; R5 - адрес начала массива

    LEA R5, NUMBERS     ; Загрузка адреса начала массива
    LD R3, LENGTH       ; Загрузка длины массива
    ADD R3, R3, #-1     ; Длина - 1 для цикла

OUTER_LOOP
    LD R4, LENGTH       ; Загрузка длины массива
    ADD R4, R4, #-1     ; Длина - 1 для цикла
    AND R2, R2, #0      ; Обнуление флага обмена

INNER_LOOP
    LDR R0, R5, #0      ; Загрузка текущего элемента
    LDR R1, R5, #1      ; Загрузка следующего элемента
    NOT R1, R1
    ADD R1, R1, #1
    ADD R1, R0, R1      ; Сравнение элементов
    BRn SWAP            ; Если R0 > R1, перейти к обмену
    BR INNER_LOOP_END

SWAP
    STR R0, R5, #1      ; Сохранение R0 на место R1
    STR R1, R5, #0      ; Сохранение R1 на место R0
    AND R2, R2, #0      ; Обнуление R2
    ADD R2, R2, #1      ; Установка флага обмена

INNER_LOOP_END
    ADD R5, R5, #1      ; Переход к следующему элементу
    ADD R4, R4, #-1     ; Уменьшение счетчика цикла
    BRp INNER_LOOP      ; Повторение внутреннего цикла
    AND R5, R5, #0      ; Обнуление R5
    LEA R5, NUMBERS     ; Возврат к началу массива
    BRz OUTER_LOOP_END  ; Если не было обменов, выход из цикла
    ADD R3, R3, #-1     ; Уменьшение счетчика цикла
    BR OUTER_LOOP       ; Повторение внешнего цикла

OUTER_LOOP_END
    HALT                ; Остановка программы

NUMBERS .FILL x0035    ; Пример массива чисел (ASCII коды)
        .FILL x0032
        .FILL x0034
        .FILL x0031
        .FILL x0033
LENGTH .FILL #5        ; Длина массива

.END
